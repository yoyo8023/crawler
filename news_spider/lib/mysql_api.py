# coding:utf8
import os
import sys
from datetime import datetime

import MySQLdb

from conf import settings
from lib.char_change import char_change_latin


import logging
import logging.config

logging.config.fileConfig(os.path.join('conf', "logging.conf"))
logger = logging.getLogger("example01")


def insert_news_to_mysql(data_list):
    try:
        db = MySQLdb.connect(
                host=settings.DATABASES['HOST'],
                port=settings.DATABASES['PORT'],
                user=settings.DATABASES['USER'],
                passwd=settings.DATABASES['PASSWORD'],
                db=settings.DATABASES['NAME'],
                charset='utf8',
        )
    except Exception, info:
        logger.debug("Error '%s' happened on line %d" % (info[0], info[1][1]))
        sys.exit()

    cursor = db.cursor()
    # 插入多条数据
    news_base_sql = "insert into news_base(TITLE, " \
                    "CONTENT_TXT, GROUP_PIC_MODE, PUBLIC_TIME, AUTHOR, FROM_SRC, TEMPLATE_TYPE, " \
                    " IS_OUR, IS_SHOW, SORT_NO, CREATOR_ID, PRICE_ID, SUMMARY" \
                    ") values ('%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')"

    img_base_sql = "insert into img_base(BIZ_TYPE, " \
                   "BIZ_RID, USE_TYPE, IMG_PATH, IMG_INDEX, IMG_TITLE" \
                   ") values ('%s', '%s', '%s', '%s', '%s', '%s')"
    for data in data_list:
        artile = data['artile']
        artile = artile.replace(u'搜狐娱乐讯','')
        tmp_tuple = (data['title'],
                     artile,
                     data['pic_mode'],
                     datetime.now(),
                     u'爬虫',
                     data['source'],
                     1,
                     3,
                     0,
                     0,
                     9,
                     1,
                     u'')
        sql = news_base_sql % tmp_tuple
        print sql
        cursor.execute(sql)
        news_last_id = cursor.lastrowid
        for index, img in enumerate(data['img_list']):
            img_tuple = (1,
                         news_last_id,
                         1,
                         img[1],
                         index,
                         img[0])
            img_sql = img_base_sql % img_tuple
            cursor.execute(img_sql)
    db.commit()
    db.close()


if __name__ == '__main__':
    data_list = [{'img_list': [(u'\xb3\xcc\xe3\xba\xa1\xb6\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb7\xbe\xe7\xd5\xd5',
                                u'http://hcmtest.oss-cn-hangzhou.aliyuncs.com/spider/6ec2dc43-fcc8-4057-8a70-2892e80715ca.jpg')],
                  'source': u'http://yule.sohu.com/20160126/n435843206.shtml',
                  'artile': u'\xa1\xa1\xa1\xa1\xcb\xd1\xba\xfc\xd3\xe9\xc0\xd6\xd1\xb6 \xd3\xc9\xd6\xf8\xc3\xfb\xbe\xfc\xc2\xc3\xbe\xe7\xcd\xf5\xc5\xc6\xd6\xc6\xd7\xf7\xc8\xcb\xef\xfa\xb5\xc0\xc7\xe0\xb5\xa3\xc8\xce\xd6\xc6\xd7\xf7\xd7\xdc\xbc\xe0\xa3\xac\xa1\xb0\xc0\xc7\xd1\xc0\xc9\xd9\xcb\xa7\xa1\xb1\xc1\xf5\xc3\xcd\xb5\xa3\xb5\xb1\xd6\xb8\xb5\xbc\xa3\xac\xca\xb5\xc1\xa6\xc5\xc9\xd1\xdd\xd4\xb1\xb3\xcc\xe3\xba\xc1\xec\xcf\xce\xd6\xf7\xd1\xdd\xb5\xc4\xb4\xf3\xd0\xcd\xbe\xfc\xc2\xc3\xbe\xde\xd6\xc6\xa1\xb6\xce\xd2\xca\xc7\xcc\xd8\xd6\xd6\xb1\xf8\xd6\xae\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb7\xd5\xfd\xd4\xda\xbd\xad\xcb\xd5\xce\xc0\xca\xd3\xbb\xc6\xbd\xf0\xb5\xb5\xbb\xf0\xc8\xc8\xb2\xa5\xb3\xf6\xd6\xd0\xa1\xa3\xbe\xe7\xd6\xd0\xa3\xac\xb3\xcc\xe3\xba\xd2\xbb\xc1\xb2\xce\xc2\xc8\xe1\xd3\xc5\xd1\xc5\xc6\xf8\xd6\xca\xa3\xac\xb1\xe4\xc9\xed\xd3\xa2\xd7\xcb\xec\xaa\xcb\xac\xb5\xc4\xcc\xd8\xd6\xd6\xc5\xae\xb1\xf8\xa1\xa3\xa1\xa1\xa1\xa1\xca\xb5\xc1\xa6\xd1\xdd\xd4\xb1\xb3\xcc\xe3\xba\xd4\xda\xbe\xe7\xd6\xd0\xca\xce\xd1\xdd\xd2\xbb\xce\xbb\xc9\xc6\xc1\xbc\xc7\xd2\xd3\xd0\xb5\xa3\xb5\xb1\xb5\xc4\xcc\xd8\xd6\xd6\xc5\xae\xb1\xf8\xd4\xf8\xd7\xcf\xc4\xb0\xa1\xa3\xcb\xe6\xd7\xc5\xbe\xe7\xc7\xe9\xd2\xbb\xb2\xbd\xd2\xbb\xb2\xbd\xb5\xc4\xb7\xa2\xd5\xb9\xa3\xac\xbe\xe7\xc7\xe9\xd2\xb2\xbd\xf8\xc8\xeb\xc1\xcb\xb0\xd7\xc8\xc8\xbb\xaf\xbd\xd7\xb6\xce\xa1\xa3\xc9\xed\xce\xaa\xa1\xb0\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb1\xcc\xd8\xd5\xbd\xb2\xbf\xb6\xd3\xd6\xd0\xb5\xc4\xd2\xbb\xd4\xb1\xa3\xac\xd4\xf8\xd7\xcf\xc4\xb0\xa3\xa8\xb3\xcc\xe3\xba \xca\xce\xa3\xa9\xbf\xaa\xca\xbc\xc1\xcb\xcb\xfd\xbc\xe8\xbf\xe0\xb5\xc4\xd1\xb5\xc1\xb7\xa3\xac\xb1\xbb\xb8\xdf\xd1\xb9\xcb\xae\xc7\xb9\xa1\xb0\xc9\xa8\xc9\xe4\xa1\xb1\xa1\xa2\xb9\xf6\xc4\xe0\xcc\xb6\xa1\xa2\xcf\xdd\xd5\xd3\xd4\xf3\xb5\xc8\xb5\xc8\xa3\xac\xb6\xd4\xd3\xda\xc8\xe1\xc8\xf5\xb5\xc4\xc5\xae\xc9\xfa\xc0\xb4\xcb\xb5\xa3\xac\xd5\xe2\xd0\xa9\xb8\xdf\xc7\xbf\xb6\xc8\xb5\xc4\xd1\xb5\xc1\xb7\xca\xae\xb7\xd6\xbc\xe8\xbf\xe0\xa3\xac\xb6\xf8\xd4\xf8\xd7\xcf\xc4\xb0\xa3\xa8\xb3\xcc\xe3\xba \xca\xce\xa3\xa9\xd2\xb2\xca\xbc\xd6\xd5\xbc\xe1\xb3\xd6\xd7\xc5\xd7\xd4\xbc\xba\xb5\xc4\xd0\xc5\xc4\xee\xd3\xc0\xb2\xbb\xd1\xd4\xc6\xfa\xa1\xa3\xb3\xcc\xe3\xba\xce\xaa\xc1\xcb\xbd\xab\xd5\xe2\xb8\xf6\xbd\xc7\xc9\xab\xda\xb9\xca\xcd\xba\xc3\xa3\xac\xcb\xf9\xd3\xd0\xb5\xc4\xc5\xc4\xc9\xe3\xc8\xab\xb2\xbf\xc7\xd7\xc9\xed\xb3\xa2\xca\xd4\xa3\xac\xd7\xee\xd6\xd5\xa3\xac\xcd\xa8\xb9\xfd\xcb\xfd\xb5\xc4\xb2\xbb\xd0\xb8\xc5\xac\xc1\xa6\xc8\xc3\xce\xd2\xc3\xc7\xbf\xb4\xb5\xbd\xc1\xcb\xd5\xe2\xb8\xf6\xb3\xf6\xc9\xab\xb5\xc4\xcc\xd8\xd6\xd6\xb1\xf8\xd0\xce\xcf\xf3\xa3\xac\xb6\xf8\xcb\xfd\xb2\xbb\xce\xb7\xbc\xe8\xd0\xc1\xb5\xc4\xbe\xab\xc9\xf1\xd2\xb2\xc8\xc3\xb9\xdb\xd6\xda\xce\xaa\xd6\xae\xd5\xf0\xba\xb3\xa1\xa3\xb8\xfc\xd3\xd0\xcd\xf8\xd3\xd1\xc1\xf4\xd1\xd4\xb5\xbd\xa3\xba\xa1\xb0\u2018\xcc\xd8\xd6\xd6\xb1\xf8\u2019\xb5\xc4\xbe\xab\xc9\xf1\xd4\xda\xb3\xcc\xe3\xba\xc9\xed\xc9\xcf\xb5\xc3\xb5\xbd\xc1\xcb\xb3\xe4\xb7\xd6\xb5\xc4\xcc\xe5\xcf\xd6\xa1\xb1\xa1\xa3\xa1\xa1\xa1\xa1\xbe\xdd\xcf\xa4\xa3\xac\xcb\xe6\xd7\xc5\xa1\xb6\xce\xd2\xca\xc7\xcc\xd8\xd6\xd6\xb1\xf8\xd6\xae\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb7\xb5\xc4\xc8\xc8\xb2\xa5\xa3\xac\xb8\xc3\xbe\xe7\xb5\xc4\xca\xd5\xca\xd3\xc2\xca\xd6\xb1\xcf\xdf\xc9\xcf\xd5\xc7\xa1\xa3\xd3\xfb\xd6\xaa\xb8\xfc\xb6\xe0\xbe\xab\xb2\xca\xc4\xda\xc8\xdd\xa3\xac\xbe\xb4\xc7\xeb\xb9\xd8\xd7\xa2\xbd\xad\xcb\xd5\xce\xc0\xca\xd3\xb6\xc0\xb2\xa5\xb5\xc4\xb4\xf3\xd0\xcd\xbe\xfc\xc2\xc3\xbe\xde\xd6\xc6\xa1\xb6\xce\xd2\xca\xc7\xcc\xd8\xd6\xd6\xb1\xf8\xd6\xae\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb7\xa1\xa3',
                  'pic_mode': 0,
                  'title': u'\xa1\xb6\xc5\xf9\xf6\xa8\xbb\xf0\xa1\xb7\xb3\xcc\xe3\xba\xca\xd5\xc1\xb2\xce\xc2\xc8\xe1 \xb0\xd4\xc6\xf8\xda\xb9\xca\xcd\xa1\xb0\xcc\xd8\xd6\xd6\xbe\xab\xc9\xf1\xa1\xb1'}]
    insert_news_to_mysql(data_list)
